/* eslint-disable no-console */
/*
 * Local:
 *    `DYNAMODB_URL="http://localhost:8000" dynamoPrefix="local" node services/database/scripts/add-less-than-eleven-mask.js`
 *  Branch:
 *    dynamoPrefix="YOUR BRANCH NAME" node services/database/scripts/add-less-than-eleven-mask.js
 */

const { buildDynamoClient, scan, update } = require("./utils/dynamodb.js");

const isLocal = !!process.env.DYNAMODB_URL;

const sectionTable = isLocal
  ? "local-section"
  : process.env.dynamoPrefix + "-section";

let fieldsUpdated = [];

const section3FieldsToUpdate = {
  2023: [
    // 2023 Fields
    "2023-03-c-02-01",
    "2023-03-c-02-02",
    "2023-03-c-02-03",
    "2023-03-c-02-03-a",
    "2023-03-c-02-04",
    "2023-03-c-03-01",
    "2023-03-c-03-02",
    "2023-03-c-03-03",
    "2023-03-c-03-04",
    "2023-03-c-03-04-a",
    "2023-03-c-03-04-b",
    "2023-03-c-03-04-c",
    "2023-03-c-04-01",
    "2023-03-c-04-02",
    "2023-03-c-04-03",
    "2023-03-c-04-04",
    "2023-03-c-04-04-a",
    "2023-03-c-04-04-b",
    "2023-03-c-04-04-c",
    "2023-03-c-05-03-a",
    "2023-03-c-05-03-b",
    "2023-03-c-05-03-c",
    "2023-03-c-05-03-d",
    "2023-03-c-05-03-e",
    "2023-03-c-05-04-a",
    "2023-03-c-05-04-b",
    "2023-03-c-05-04-c",
    "2023-03-c-05-04-d",
    "2023-03-c-05-04-e",
    "2023-03-c-05-05-a",
    "2023-03-c-05-05-b",
    "2023-03-c-05-05-c",
    "2023-03-c-05-05-d",
    "2023-03-c-05-05-e",
    "2023-03-c-05-06-a",
    "2023-03-c-05-06-b",
    "2023-03-c-05-06-c",
    "2023-03-c-05-06-d",
    "2023-03-c-05-06-e",
    "2023-03-c-05-07-a",
    "2023-03-c-05-07-b",
    "2023-03-c-05-07-c",
    "2023-03-c-05-07-d",
    "2023-03-c-05-07-e",
    "2023-03-c-05-08-a",
    "2023-03-c-05-08-b",
    "2023-03-c-05-08-c",
    "2023-03-c-05-08-d",
    "2023-03-c-05-08-e",
    "2023-03-c-05-10-a",
    "2023-03-c-05-10-b",
    "2023-03-c-05-10-c",
    "2023-03-c-05-10-d",
    "2023-03-c-05-10-e",
    "2023-03-c-05-11-a",
    "2023-03-c-05-11-b",
    "2023-03-c-05-11-c",
    "2023-03-c-05-11-d",
    "2023-03-c-05-11-e",
    "2023-03-c-05-12-a",
    "2023-03-c-05-12-b",
    "2023-03-c-05-12-c",
    "2023-03-c-05-12-d",
    "2023-03-c-05-12-e",
    "2023-03-c-05-13-a",
    "2023-03-c-05-13-b",
    "2023-03-c-05-13-c",
    "2023-03-c-05-13-d",
    "2023-03-c-05-13-e",
    "2023-03-c-05-14-a",
    "2023-03-c-05-14-b",
    "2023-03-c-05-14-c",
    "2023-03-c-05-14-d",
    "2023-03-c-05-14-e",
    "2023-03-c-05-15-a",
    "2023-03-c-05-15-b",
    "2023-03-c-05-15-c",
    "2023-03-c-05-15-d",
    "2023-03-c-05-15-e",
    "2023-03-c-05-16-a",
    "2023-03-c-05-16-b",
    "2023-03-c-05-16-c",
    "2023-03-c-05-16-d",
    "2023-03-c-05-16-e",
    "2023-03-c-05-17-a",
    "2023-03-c-05-17-b",
    "2023-03-c-05-17-c",
    "2023-03-c-05-17-d",
    "2023-03-c-05-17-e",
    "2023-03-c-05-18-a",
    "2023-03-c-05-18-b",
    "2023-03-c-05-18-c",
    "2023-03-c-05-18-d",
    "2023-03-c-05-18-e",
    "2023-03-c-05-19-a",
    "2023-03-c-05-19-b",
    "2023-03-c-05-19-c",
    "2023-03-c-05-19-d",
    "2023-03-c-05-19-e",
    "2023-03-c-06-03-a",
    "2023-03-c-06-03-b",
    "2023-03-c-06-03-c",
    "2023-03-c-06-03-d",
    "2023-03-c-06-03-e",
    "2023-03-c-06-04-a",
    "2023-03-c-06-04-b",
    "2023-03-c-06-04-c",
    "2023-03-c-06-04-d",
    "2023-03-c-06-04-e",
    "2023-03-c-06-05-a",
    "2023-03-c-06-05-b",
    "2023-03-c-06-05-c",
    "2023-03-c-06-05-d",
    "2023-03-c-06-05-e",
    "2023-03-c-06-06-a",
    "2023-03-c-06-06-b",
    "2023-03-c-06-06-c",
    "2023-03-c-06-06-d",
    "2023-03-c-06-06-e",
    "2023-03-c-06-07-a",
    "2023-03-c-06-07-b",
    "2023-03-c-06-07-c",
    "2023-03-c-06-07-d",
    "2023-03-c-06-07-e",
    "2023-03-c-06-08-a",
    "2023-03-c-06-08-b",
    "2023-03-c-06-08-c",
    "2023-03-c-06-08-d",
    "2023-03-c-06-08-e",
    "2023-03-c-06-10-a",
    "2023-03-c-06-10-b",
    "2023-03-c-06-10-c",
    "2023-03-c-06-10-d",
    "2023-03-c-06-10-e",
    "2023-03-c-06-11-a",
    "2023-03-c-06-11-b",
    "2023-03-c-06-11-c",
    "2023-03-c-06-11-d",
    "2023-03-c-06-11-e",
    "2023-03-c-06-12-a",
    "2023-03-c-06-12-b",
    "2023-03-c-06-12-c",
    "2023-03-c-06-12-d",
    "2023-03-c-06-12-e",
    "2023-03-c-06-13-a",
    "2023-03-c-06-13-b",
    "2023-03-c-06-13-c",
    "2023-03-c-06-13-d",
    "2023-03-c-06-13-e",
    "2023-03-c-06-14-a",
    "2023-03-c-06-14-b",
    "2023-03-c-06-14-c",
    "2023-03-c-06-14-d",
    "2023-03-c-06-14-e",
    "2023-03-c-06-15-a",
    "2023-03-c-06-15-b",
    "2023-03-c-06-15-c",
    "2023-03-c-06-15-d",
    "2023-03-c-06-15-e",
    "2023-03-c-06-16-a",
    "2023-03-c-06-16-b",
    "2023-03-c-06-16-c",
    "2023-03-c-06-16-d",
    "2023-03-c-06-16-e",
    "2023-03-c-06-17-a",
    "2023-03-c-06-17-b",
    "2023-03-c-06-17-c",
    "2023-03-c-06-17-d",
    "2023-03-c-06-17-e",
    "2023-03-c-06-18-a",
    "2023-03-c-06-18-b",
    "2023-03-c-06-18-c",
    "2023-03-c-06-18-d",
    "2023-03-c-06-18-e",
    "2023-03-c-06-19-a",
    "2023-03-c-06-19-b",
    "2023-03-c-06-19-c",
    "2023-03-c-06-19-d",
    "2023-03-c-06-19-e",
    "2023-03-f-01-06",
    "2023-03-f-01-07",
    "2023-03-f-01-12",
    "2023-03-f-01-13",
    "2023-03-g-01-02-a",
    "2023-03-g-01-02-b",
    "2023-03-g-01-02-c",
    "2023-03-g-01-02-d",
    "2023-03-g-01-02-e",
    "2023-03-g-01-02-f",
    "2023-03-g-01-02-g",
    "2023-03-g-01-03-a",
    "2023-03-g-01-03-b",
    "2023-03-g-01-03-c",
    "2023-03-g-01-03-d",
    "2023-03-g-01-03-e",
    "2023-03-g-01-03-f",
    "2023-03-g-01-03-g",
    "2023-03-g-01-04-a",
    "2023-03-g-01-04-b",
    "2023-03-g-01-04-c",
    "2023-03-g-01-04-d",
    "2023-03-g-01-04-e",
    "2023-03-g-01-04-f",
    "2023-03-g-01-04-g",
    "2023-03-g-01-05-a",
    "2023-03-g-01-05-b",
    "2023-03-g-01-05-c",
    "2023-03-g-01-05-d",
    "2023-03-g-01-05-e",
    "2023-03-g-01-05-f",
    "2023-03-g-01-05-g",
    "2023-03-g-01-06",
    "2023-03-i-02-01-01-04",
    "2023-03-i-02-01-01-05",
  ],
  2022: [
    // 2022 Fields
    "2022-03-c-02-01",
    "2022-03-c-02-02",
    "2022-03-c-02-03",
    "2022-03-c-02-03-a",
    "2022-03-c-02-04",
    "2022-03-c-03-01",
    "2022-03-c-03-02",
    "2022-03-c-03-03",
    "2022-03-c-03-04",
    "2022-03-c-03-04-a",
    "2022-03-c-03-04-b",
    "2022-03-c-03-04-c",
    "2022-03-c-04-01",
    "2022-03-c-04-02",
    "2022-03-c-04-03",
    "2022-03-c-04-04",
    "2022-03-c-04-04-a",
    "2022-03-c-04-04-b",
    "2022-03-c-04-04-c",
    "2022-03-c-05-03-a",
    "2022-03-c-05-03-b",
    "2022-03-c-05-03-c",
    "2022-03-c-05-03-d",
    "2022-03-c-05-03-e",
    "2022-03-c-05-04-a",
    "2022-03-c-05-04-b",
    "2022-03-c-05-04-c",
    "2022-03-c-05-04-d",
    "2022-03-c-05-04-e",
    "2022-03-c-05-05-a",
    "2022-03-c-05-05-b",
    "2022-03-c-05-05-c",
    "2022-03-c-05-05-d",
    "2022-03-c-05-05-e",
    "2022-03-c-05-06-a",
    "2022-03-c-05-06-b",
    "2022-03-c-05-06-c",
    "2022-03-c-05-06-d",
    "2022-03-c-05-06-e",
    "2022-03-c-05-07-a",
    "2022-03-c-05-07-b",
    "2022-03-c-05-07-c",
    "2022-03-c-05-07-d",
    "2022-03-c-05-07-e",
    "2022-03-c-05-08-a",
    "2022-03-c-05-08-b",
    "2022-03-c-05-08-c",
    "2022-03-c-05-08-d",
    "2022-03-c-05-08-e",
    "2022-03-c-05-10-a",
    "2022-03-c-05-10-b",
    "2022-03-c-05-10-c",
    "2022-03-c-05-10-d",
    "2022-03-c-05-10-e",
    "2022-03-c-05-11-a",
    "2022-03-c-05-11-b",
    "2022-03-c-05-11-c",
    "2022-03-c-05-11-d",
    "2022-03-c-05-11-e",
    "2022-03-c-05-12-a",
    "2022-03-c-05-12-b",
    "2022-03-c-05-12-c",
    "2022-03-c-05-12-d",
    "2022-03-c-05-12-e",
    "2022-03-c-05-13-a",
    "2022-03-c-05-13-b",
    "2022-03-c-05-13-c",
    "2022-03-c-05-13-d",
    "2022-03-c-05-13-e",
    "2022-03-c-05-14-a",
    "2022-03-c-05-14-b",
    "2022-03-c-05-14-c",
    "2022-03-c-05-14-d",
    "2022-03-c-05-14-e",
    "2022-03-c-05-15-a",
    "2022-03-c-05-15-b",
    "2022-03-c-05-15-c",
    "2022-03-c-05-15-d",
    "2022-03-c-05-15-e",
    "2022-03-c-05-16-a",
    "2022-03-c-05-16-b",
    "2022-03-c-05-16-c",
    "2022-03-c-05-16-d",
    "2022-03-c-05-16-e",
    "2022-03-c-05-17-a",
    "2022-03-c-05-17-b",
    "2022-03-c-05-17-c",
    "2022-03-c-05-17-d",
    "2022-03-c-05-17-e",
    "2022-03-c-05-18-a",
    "2022-03-c-05-18-b",
    "2022-03-c-05-18-c",
    "2022-03-c-05-18-d",
    "2022-03-c-05-18-e",
    "2022-03-c-05-19-a",
    "2022-03-c-05-19-b",
    "2022-03-c-05-19-c",
    "2022-03-c-05-19-d",
    "2022-03-c-05-19-e",
    "2022-03-c-06-03-a",
    "2022-03-c-06-03-b",
    "2022-03-c-06-03-c",
    "2022-03-c-06-03-d",
    "2022-03-c-06-03-e",
    "2022-03-c-06-04-a",
    "2022-03-c-06-04-b",
    "2022-03-c-06-04-c",
    "2022-03-c-06-04-d",
    "2022-03-c-06-04-e",
    "2022-03-c-06-05-a",
    "2022-03-c-06-05-b",
    "2022-03-c-06-05-c",
    "2022-03-c-06-05-d",
    "2022-03-c-06-05-e",
    "2022-03-c-06-06-a",
    "2022-03-c-06-06-b",
    "2022-03-c-06-06-c",
    "2022-03-c-06-06-d",
    "2022-03-c-06-06-e",
    "2022-03-c-06-07-a",
    "2022-03-c-06-07-b",
    "2022-03-c-06-07-c",
    "2022-03-c-06-07-d",
    "2022-03-c-06-07-e",
    "2022-03-c-06-08-a",
    "2022-03-c-06-08-b",
    "2022-03-c-06-08-c",
    "2022-03-c-06-08-d",
    "2022-03-c-06-08-e",
    "2022-03-c-06-10-a",
    "2022-03-c-06-10-b",
    "2022-03-c-06-10-c",
    "2022-03-c-06-10-d",
    "2022-03-c-06-10-e",
    "2022-03-c-06-11-a",
    "2022-03-c-06-11-b",
    "2022-03-c-06-11-c",
    "2022-03-c-06-11-d",
    "2022-03-c-06-11-e",
    "2022-03-c-06-12-a",
    "2022-03-c-06-12-b",
    "2022-03-c-06-12-c",
    "2022-03-c-06-12-d",
    "2022-03-c-06-12-e",
    "2022-03-c-06-13-a",
    "2022-03-c-06-13-b",
    "2022-03-c-06-13-c",
    "2022-03-c-06-13-d",
    "2022-03-c-06-13-e",
    "2022-03-c-06-14-a",
    "2022-03-c-06-14-b",
    "2022-03-c-06-14-c",
    "2022-03-c-06-14-d",
    "2022-03-c-06-14-e",
    "2022-03-c-06-15-a",
    "2022-03-c-06-15-b",
    "2022-03-c-06-15-c",
    "2022-03-c-06-15-d",
    "2022-03-c-06-15-e",
    "2022-03-c-06-16-a",
    "2022-03-c-06-16-b",
    "2022-03-c-06-16-c",
    "2022-03-c-06-16-d",
    "2022-03-c-06-16-e",
    "2022-03-c-06-17-a",
    "2022-03-c-06-17-b",
    "2022-03-c-06-17-c",
    "2022-03-c-06-17-d",
    "2022-03-c-06-17-e",
    "2022-03-c-06-18-a",
    "2022-03-c-06-18-b",
    "2022-03-c-06-18-c",
    "2022-03-c-06-18-d",
    "2022-03-c-06-18-e",
    "2022-03-c-06-19-a",
    "2022-03-c-06-19-b",
    "2022-03-c-06-19-c",
    "2022-03-c-06-19-d",
    "2022-03-c-06-19-e",
    "2022-03-f-01-06",
    "2022-03-f-01-07",
    "2022-03-f-01-12",
    "2022-03-f-01-13",
    "2022-03-g-01-02-a",
    "2022-03-g-01-02-b",
    "2022-03-g-01-02-c",
    "2022-03-g-01-02-d",
    "2022-03-g-01-02-e",
    "2022-03-g-01-02-f",
    "2022-03-g-01-02-g",
    "2022-03-g-01-03-a",
    "2022-03-g-01-03-b",
    "2022-03-g-01-03-c",
    "2022-03-g-01-03-d",
    "2022-03-g-01-03-e",
    "2022-03-g-01-03-f",
    "2022-03-g-01-03-g",
    "2022-03-g-01-04-a",
    "2022-03-g-01-04-b",
    "2022-03-g-01-04-c",
    "2022-03-g-01-04-d",
    "2022-03-g-01-04-e",
    "2022-03-g-01-04-f",
    "2022-03-g-01-04-g",
    "2022-03-g-01-05-a",
    "2022-03-g-01-05-b",
    "2022-03-g-01-05-c",
    "2022-03-g-01-05-d",
    "2022-03-g-01-05-e",
    "2022-03-g-01-05-f",
    "2022-03-g-01-05-g",
    "2022-03-g-01-06",
    "2022-03-i-02-01-01-04",
    "2022-03-i-02-01-01-05",
  ],
  2021: [
    // 2021 Fields
    "2021-03-c-02-01",
    "2021-03-c-02-02",
    "2021-03-c-02-03",
    "2021-03-c-02-03-a",
    "2021-03-c-02-04",
    "2021-03-c-03-01",
    "2021-03-c-03-02",
    "2021-03-c-03-03",
    "2021-03-c-03-04",
    "2021-03-c-03-04-a",
    "2021-03-c-03-04-b",
    "2021-03-c-03-04-c",
    "2021-03-c-04-01",
    "2021-03-c-04-02",
    "2021-03-c-04-03",
    "2021-03-c-04-04",
    "2021-03-c-04-04-a",
    "2021-03-c-04-04-b",
    "2021-03-c-04-04-c",
    "2021-03-c-05-03-a",
    "2021-03-c-05-03-b",
    "2021-03-c-05-03-c",
    "2021-03-c-05-03-d",
    "2021-03-c-05-03-e",
    "2021-03-c-05-04-a",
    "2021-03-c-05-04-b",
    "2021-03-c-05-04-c",
    "2021-03-c-05-04-d",
    "2021-03-c-05-04-e",
    "2021-03-c-05-05-a",
    "2021-03-c-05-05-b",
    "2021-03-c-05-05-c",
    "2021-03-c-05-05-d",
    "2021-03-c-05-05-e",
    "2021-03-c-05-06-a",
    "2021-03-c-05-06-b",
    "2021-03-c-05-06-c",
    "2021-03-c-05-06-d",
    "2021-03-c-05-06-e",
    "2021-03-c-05-07-a",
    "2021-03-c-05-07-b",
    "2021-03-c-05-07-c",
    "2021-03-c-05-07-d",
    "2021-03-c-05-07-e",
    "2021-03-c-05-08-a",
    "2021-03-c-05-08-b",
    "2021-03-c-05-08-c",
    "2021-03-c-05-08-d",
    "2021-03-c-05-08-e",
    "2021-03-c-05-10-a",
    "2021-03-c-05-10-b",
    "2021-03-c-05-10-c",
    "2021-03-c-05-10-d",
    "2021-03-c-05-10-e",
    "2021-03-c-05-11-a",
    "2021-03-c-05-11-b",
    "2021-03-c-05-11-c",
    "2021-03-c-05-11-d",
    "2021-03-c-05-11-e",
    "2021-03-c-05-12-a",
    "2021-03-c-05-12-b",
    "2021-03-c-05-12-c",
    "2021-03-c-05-12-d",
    "2021-03-c-05-12-e",
    "2021-03-c-05-13-a",
    "2021-03-c-05-13-b",
    "2021-03-c-05-13-c",
    "2021-03-c-05-13-d",
    "2021-03-c-05-13-e",
    "2021-03-c-05-14-a",
    "2021-03-c-05-14-b",
    "2021-03-c-05-14-c",
    "2021-03-c-05-14-d",
    "2021-03-c-05-14-e",
    "2021-03-c-05-15-a",
    "2021-03-c-05-15-b",
    "2021-03-c-05-15-c",
    "2021-03-c-05-15-d",
    "2021-03-c-05-15-e",
    "2021-03-c-05-16-a",
    "2021-03-c-05-16-b",
    "2021-03-c-05-16-c",
    "2021-03-c-05-16-d",
    "2021-03-c-05-16-e",
    "2021-03-c-05-17-a",
    "2021-03-c-05-17-b",
    "2021-03-c-05-17-c",
    "2021-03-c-05-17-d",
    "2021-03-c-05-17-e",
    "2021-03-c-05-18-a",
    "2021-03-c-05-18-b",
    "2021-03-c-05-18-c",
    "2021-03-c-05-18-d",
    "2021-03-c-05-18-e",
    "2021-03-c-05-19-a",
    "2021-03-c-05-19-b",
    "2021-03-c-05-19-c",
    "2021-03-c-05-19-d",
    "2021-03-c-05-19-e",
    "2021-03-c-06-03-a",
    "2021-03-c-06-03-b",
    "2021-03-c-06-03-c",
    "2021-03-c-06-03-d",
    "2021-03-c-06-03-e",
    "2021-03-c-06-04-a",
    "2021-03-c-06-04-b",
    "2021-03-c-06-04-c",
    "2021-03-c-06-04-d",
    "2021-03-c-06-04-e",
    "2021-03-c-06-05-a",
    "2021-03-c-06-05-b",
    "2021-03-c-06-05-c",
    "2021-03-c-06-05-d",
    "2021-03-c-06-05-e",
    "2021-03-c-06-06-a",
    "2021-03-c-06-06-b",
    "2021-03-c-06-06-c",
    "2021-03-c-06-06-d",
    "2021-03-c-06-06-e",
    "2021-03-c-06-07-a",
    "2021-03-c-06-07-b",
    "2021-03-c-06-07-c",
    "2021-03-c-06-07-d",
    "2021-03-c-06-07-e",
    "2021-03-c-06-08-a",
    "2021-03-c-06-08-b",
    "2021-03-c-06-08-c",
    "2021-03-c-06-08-d",
    "2021-03-c-06-08-e",
    "2021-03-c-06-10-a",
    "2021-03-c-06-10-b",
    "2021-03-c-06-10-c",
    "2021-03-c-06-10-d",
    "2021-03-c-06-10-e",
    "2021-03-c-06-11-a",
    "2021-03-c-06-11-b",
    "2021-03-c-06-11-c",
    "2021-03-c-06-11-d",
    "2021-03-c-06-11-e",
    "2021-03-c-06-12-a",
    "2021-03-c-06-12-b",
    "2021-03-c-06-12-c",
    "2021-03-c-06-12-d",
    "2021-03-c-06-12-e",
    "2021-03-c-06-13-a",
    "2021-03-c-06-13-b",
    "2021-03-c-06-13-c",
    "2021-03-c-06-13-d",
    "2021-03-c-06-13-e",
    "2021-03-c-06-14-a",
    "2021-03-c-06-14-b",
    "2021-03-c-06-14-c",
    "2021-03-c-06-14-d",
    "2021-03-c-06-14-e",
    "2021-03-c-06-15-a",
    "2021-03-c-06-15-b",
    "2021-03-c-06-15-c",
    "2021-03-c-06-15-d",
    "2021-03-c-06-15-e",
    "2021-03-c-06-16-a",
    "2021-03-c-06-16-b",
    "2021-03-c-06-16-c",
    "2021-03-c-06-16-d",
    "2021-03-c-06-16-e",
    "2021-03-c-06-17-a",
    "2021-03-c-06-17-b",
    "2021-03-c-06-17-c",
    "2021-03-c-06-17-d",
    "2021-03-c-06-17-e",
    "2021-03-c-06-18-a",
    "2021-03-c-06-18-b",
    "2021-03-c-06-18-c",
    "2021-03-c-06-18-d",
    "2021-03-c-06-18-e",
    "2021-03-c-06-19-a",
    "2021-03-c-06-19-b",
    "2021-03-c-06-19-c",
    "2021-03-c-06-19-d",
    "2021-03-c-06-19-e",
    "2021-03-f-01-06",
    "2021-03-f-01-07",
    "2021-03-f-01-12",
    "2021-03-f-01-13",
    "2021-03-g-01-02-a",
    "2021-03-g-01-02-b",
    "2021-03-g-01-02-c",
    "2021-03-g-01-02-d",
    "2021-03-g-01-02-e",
    "2021-03-g-01-02-f",
    "2021-03-g-01-02-g",
    "2021-03-g-01-03-a",
    "2021-03-g-01-03-b",
    "2021-03-g-01-03-c",
    "2021-03-g-01-03-d",
    "2021-03-g-01-03-e",
    "2021-03-g-01-03-f",
    "2021-03-g-01-03-g",
    "2021-03-g-01-04-a",
    "2021-03-g-01-04-b",
    "2021-03-g-01-04-c",
    "2021-03-g-01-04-d",
    "2021-03-g-01-04-e",
    "2021-03-g-01-04-f",
    "2021-03-g-01-04-g",
    "2021-03-g-01-05-a",
    "2021-03-g-01-05-b",
    "2021-03-g-01-05-c",
    "2021-03-g-01-05-d",
    "2021-03-g-01-05-e",
    "2021-03-g-01-05-f",
    "2021-03-g-01-05-g",
    "2021-03-g-01-06",
    "2021-03-i-02-01-01-04",
    "2021-03-i-02-01-01-05",
  ],
  2020: [
    // 2020 Fields
    "2020-03-c-02-01",
    "2020-03-c-02-02",
    "2020-03-c-02-03",
    "2020-03-c-02-03-a",
    "2020-03-c-02-04",
    "2020-03-c-03-01",
    "2020-03-c-03-02",
    "2020-03-c-03-03",
    "2020-03-c-03-04",
    "2020-03-c-03-04-a",
    "2020-03-c-03-04-b",
    "2020-03-c-03-04-c",
    "2020-03-c-04-01",
    "2020-03-c-04-02",
    "2020-03-c-04-03",
    "2020-03-c-04-04",
    "2020-03-c-04-04-a",
    "2020-03-c-04-04-b",
    "2020-03-c-04-04-c",
    "2020-03-c-05-03-a",
    "2020-03-c-05-03-b",
    "2020-03-c-05-03-c",
    "2020-03-c-05-03-d",
    "2020-03-c-05-03-e",
    "2020-03-c-05-04-a",
    "2020-03-c-05-04-b",
    "2020-03-c-05-04-c",
    "2020-03-c-05-04-d",
    "2020-03-c-05-04-e",
    "2020-03-c-05-05-a",
    "2020-03-c-05-05-b",
    "2020-03-c-05-05-c",
    "2020-03-c-05-05-d",
    "2020-03-c-05-05-e",
    "2020-03-c-05-06-a",
    "2020-03-c-05-06-b",
    "2020-03-c-05-06-c",
    "2020-03-c-05-06-d",
    "2020-03-c-05-06-e",
    "2020-03-c-05-07-a",
    "2020-03-c-05-07-b",
    "2020-03-c-05-07-c",
    "2020-03-c-05-07-d",
    "2020-03-c-05-07-e",
    "2020-03-c-05-08-a",
    "2020-03-c-05-08-b",
    "2020-03-c-05-08-c",
    "2020-03-c-05-08-d",
    "2020-03-c-05-08-e",
    "2020-03-c-05-10-a",
    "2020-03-c-05-10-b",
    "2020-03-c-05-10-c",
    "2020-03-c-05-10-d",
    "2020-03-c-05-10-e",
    "2020-03-c-05-11-a",
    "2020-03-c-05-11-b",
    "2020-03-c-05-11-c",
    "2020-03-c-05-11-d",
    "2020-03-c-05-11-e",
    "2020-03-c-05-12-a",
    "2020-03-c-05-12-b",
    "2020-03-c-05-12-c",
    "2020-03-c-05-12-d",
    "2020-03-c-05-12-e",
    "2020-03-c-05-13-a",
    "2020-03-c-05-13-b",
    "2020-03-c-05-13-c",
    "2020-03-c-05-13-d",
    "2020-03-c-05-13-e",
    "2020-03-c-05-14-a",
    "2020-03-c-05-14-b",
    "2020-03-c-05-14-c",
    "2020-03-c-05-14-d",
    "2020-03-c-05-14-e",
    "2020-03-c-05-15-a",
    "2020-03-c-05-15-b",
    "2020-03-c-05-15-c",
    "2020-03-c-05-15-d",
    "2020-03-c-05-15-e",
    "2020-03-c-05-16-a",
    "2020-03-c-05-16-b",
    "2020-03-c-05-16-c",
    "2020-03-c-05-16-d",
    "2020-03-c-05-16-e",
    "2020-03-c-05-17-a",
    "2020-03-c-05-17-b",
    "2020-03-c-05-17-c",
    "2020-03-c-05-17-d",
    "2020-03-c-05-17-e",
    "2020-03-c-05-18-a",
    "2020-03-c-05-18-b",
    "2020-03-c-05-18-c",
    "2020-03-c-05-18-d",
    "2020-03-c-05-18-e",
    "2020-03-c-05-19-a",
    "2020-03-c-05-19-b",
    "2020-03-c-05-19-c",
    "2020-03-c-05-19-d",
    "2020-03-c-05-19-e",
    "2020-03-c-06-03-a",
    "2020-03-c-06-03-b",
    "2020-03-c-06-03-c",
    "2020-03-c-06-03-d",
    "2020-03-c-06-03-e",
    "2020-03-c-06-04-a",
    "2020-03-c-06-04-b",
    "2020-03-c-06-04-c",
    "2020-03-c-06-04-d",
    "2020-03-c-06-04-e",
    "2020-03-c-06-05-a",
    "2020-03-c-06-05-b",
    "2020-03-c-06-05-c",
    "2020-03-c-06-05-d",
    "2020-03-c-06-05-e",
    "2020-03-c-06-06-a",
    "2020-03-c-06-06-b",
    "2020-03-c-06-06-c",
    "2020-03-c-06-06-d",
    "2020-03-c-06-06-e",
    "2020-03-c-06-07-a",
    "2020-03-c-06-07-b",
    "2020-03-c-06-07-c",
    "2020-03-c-06-07-d",
    "2020-03-c-06-07-e",
    "2020-03-c-06-08-a",
    "2020-03-c-06-08-b",
    "2020-03-c-06-08-c",
    "2020-03-c-06-08-d",
    "2020-03-c-06-08-e",
    "2020-03-c-06-10-a",
    "2020-03-c-06-10-b",
    "2020-03-c-06-10-c",
    "2020-03-c-06-10-d",
    "2020-03-c-06-10-e",
    "2020-03-c-06-11-a",
    "2020-03-c-06-11-b",
    "2020-03-c-06-11-c",
    "2020-03-c-06-11-d",
    "2020-03-c-06-11-e",
    "2020-03-c-06-12-a",
    "2020-03-c-06-12-b",
    "2020-03-c-06-12-c",
    "2020-03-c-06-12-d",
    "2020-03-c-06-12-e",
    "2020-03-c-06-13-a",
    "2020-03-c-06-13-b",
    "2020-03-c-06-13-c",
    "2020-03-c-06-13-d",
    "2020-03-c-06-13-e",
    "2020-03-c-06-14-a",
    "2020-03-c-06-14-b",
    "2020-03-c-06-14-c",
    "2020-03-c-06-14-d",
    "2020-03-c-06-14-e",
    "2020-03-c-06-15-a",
    "2020-03-c-06-15-b",
    "2020-03-c-06-15-c",
    "2020-03-c-06-15-d",
    "2020-03-c-06-15-e",
    "2020-03-c-06-16-a",
    "2020-03-c-06-16-b",
    "2020-03-c-06-16-c",
    "2020-03-c-06-16-d",
    "2020-03-c-06-16-e",
    "2020-03-c-06-17-a",
    "2020-03-c-06-17-b",
    "2020-03-c-06-17-c",
    "2020-03-c-06-17-d",
    "2020-03-c-06-17-e",
    "2020-03-c-06-18-a",
    "2020-03-c-06-18-b",
    "2020-03-c-06-18-c",
    "2020-03-c-06-18-d",
    "2020-03-c-06-18-e",
    "2020-03-c-06-19-a",
    "2020-03-c-06-19-b",
    "2020-03-c-06-19-c",
    "2020-03-c-06-19-d",
    "2020-03-c-06-19-e",
    "2020-03-f-01-06",
    "2020-03-f-01-07",
    "2020-03-f-01-12",
    "2020-03-f-01-13",
    "2020-03-g-01-02-a",
    "2020-03-g-01-02-b",
    "2020-03-g-01-02-c",
    "2020-03-g-01-02-d",
    "2020-03-g-01-02-e",
    "2020-03-g-01-02-f",
    "2020-03-g-01-02-g",
    "2020-03-g-01-03-a",
    "2020-03-g-01-03-b",
    "2020-03-g-01-03-c",
    "2020-03-g-01-03-d",
    "2020-03-g-01-03-e",
    "2020-03-g-01-03-f",
    "2020-03-g-01-03-g",
    "2020-03-g-01-04-a",
    "2020-03-g-01-04-b",
    "2020-03-g-01-04-c",
    "2020-03-g-01-04-d",
    "2020-03-g-01-04-e",
    "2020-03-g-01-04-f",
    "2020-03-g-01-04-g",
    "2020-03-g-01-05-a",
    "2020-03-g-01-05-b",
    "2020-03-g-01-05-c",
    "2020-03-g-01-05-d",
    "2020-03-g-01-05-e",
    "2020-03-g-01-05-f",
    "2020-03-g-01-05-g",
    "2020-03-g-01-06",
    "2020-03-i-02-01-01-04",
    "2020-03-i-02-01-01-05",
  ],
};

const section4FieldsToUpdate = {
  2023: [
    // 2023 Fields
    "2023-04-a-01-01-01-02-01-04",
    "2023-04-a-01-01-01-02-01-06",
    "2023-04-a-01-01-02-02-01-04",
    "2023-04-a-01-01-02-02-01-06",
    "2023-04-a-01-01-03-02-01-04",
    "2023-04-a-01-01-03-02-01-06",
    "2023-04-a-01-01-04-02-01-04",
    "2023-04-a-01-01-04-02-01-06",
    "2023-04-a-01-01-05-02-01-04",
    "2023-04-a-01-01-05-02-01-06",
    "2023-04-a-01-01-06-02-01-04",
    "2023-04-a-01-01-06-02-01-06",
  ],
  2022: [
    // 2022 Fields
    "2022-04-a-01-01-01-02-01-04",
    "2022-04-a-01-01-01-02-01-06",
    "2022-04-a-01-01-02-02-01-04",
    "2022-04-a-01-01-02-02-01-06",
    "2022-04-a-01-01-03-02-01-04",
    "2022-04-a-01-01-03-02-01-06",
    "2022-04-a-01-01-04-02-01-04",
    "2022-04-a-01-01-04-02-01-06",
    "2022-04-a-01-01-05-02-01-04",
    "2022-04-a-01-01-05-02-01-06",
    "2022-04-a-01-01-06-02-01-04",
    "2022-04-a-01-01-06-02-01-06",
  ],
  2021: [
    // 2021 Fields
    "2021-04-a-01-01-01-02-01-04",
    "2021-04-a-01-01-01-02-01-06",
    "2021-04-a-01-01-02-02-01-04",
    "2021-04-a-01-01-02-02-01-06",
    "2021-04-a-01-01-03-02-01-04",
    "2021-04-a-01-01-03-02-01-06",
    "2021-04-a-01-01-04-02-01-04",
    "2021-04-a-01-01-04-02-01-06",
    "2021-04-a-01-01-05-02-01-04",
    "2021-04-a-01-01-05-02-01-06",
    "2021-04-a-01-01-06-02-01-04",
    "2021-04-a-01-01-06-02-01-06",
  ],
  2020: [
    // 2020 Fields
    "2020-04-a-01-01-01-02-01-04",
    "2020-04-a-01-01-01-02-01-06",
    "2020-04-a-01-01-02-02-01-04",
    "2020-04-a-01-01-02-02-01-06",
    "2020-04-a-01-01-03-02-01-04",
    "2020-04-a-01-01-03-02-01-06",
    "2020-04-a-01-01-04-02-01-04",
    "2020-04-a-01-01-04-02-01-06",
    "2020-04-a-01-01-05-02-01-04",
    "2020-04-a-01-01-05-02-01-06",
    "2020-04-a-01-01-06-02-01-04",
    "2020-04-a-01-01-06-02-01-06",
  ],
};

const section5FieldsToUpdate = {
  2023: [
    // 2023 Fields
    "2023-05-a-03-01-a",
    "2023-05-a-03-01-b",
    "2023-05-a-03-01-c",
    "2023-05-a-04-01-a",
    "2023-05-a-04-01-b",
    "2023-05-a-04-01-c",
  ],
  2022: [
    // 2022 Fields
    "2022-05-a-03-01-a",
    "2022-05-a-03-01-b",
    "2022-05-a-03-01-c",
    "2022-05-a-04-01-a",
    "2022-05-a-04-01-b",
    "2022-05-a-04-01-c",
  ],
  2021: [
    // 2021 Fields
    "2021-05-a-03-01-a",
    "2021-05-a-03-01-b",
    "2021-05-a-03-01-c",
    "2021-05-a-04-01-a",
    "2021-05-a-04-01-b",
    "2021-05-a-04-01-c",
  ],
  2020: [
    // 2020 Fields
    "2020-05-a-03-01-a",
    "2020-05-a-03-01-b",
    "2020-05-a-03-01-c",
    "2020-05-a-04-01-a",
    "2020-05-a-04-01-b",
    "2020-05-a-04-01-c",
  ],
};

async function handler() {
  try {
    console.log("Searching for Sections 3, 4, and 5");

    buildDynamoClient();

    console.log(`Processing table ${sectionTable}`);
    const existingItems = await scan({
      TableName: sectionTable,
    });
    //Update Section 3
    const filteredSection3 = filter(existingItems, 3);
    const transformedSection3 = await transform(
      filteredSection3,
      section3FieldsToUpdate
    );
    await update(sectionTable, transformedSection3);
    console.log(
      `Touched ${transformedSection3.length} in table ${sectionTable} for section 3`
    );

    //Update Section 4
    const filteredSection4 = filter(existingItems, 4);
    const transformedSection4 = await transform(
      filteredSection4,
      section4FieldsToUpdate
    );
    await update(sectionTable, transformedSection4);
    console.log(
      `Touched ${transformedSection4.length} in table ${sectionTable} for section 4`
    );

    // Update Section 5
    const filteredSection5 = filter(existingItems, 5);
    const transformedSection5 = await transform(
      filteredSection5,
      section5FieldsToUpdate
    );
    await update(sectionTable, transformedSection5);
    console.log(
      `Touched ${transformedSection5.length} in table ${sectionTable} for section 5`
    );
    console.debug("Data fix complete");

    return {
      statusCode: 200,
      body: "All done!",
    };
  } catch (err) {
    console.error(err);
    return {
      statusCode: 500,
      body: err.message,
    };
  }
}

function filter(items, sectionId) {
  return items.filter((item) => item.sectionId === sectionId);
}

async function transform(items, fieldstoUpdate) {
  // Touch sync field only
  const transformed = items.map((section) => {
    console.log("Transforming section!", section);
    return findQuestionsToUpdate(section, fieldstoUpdate[section.year]);
  });

  return transformed;
}

const findQuestionsToUpdate = (section, fieldsToUpdate) => {
  fieldsUpdated = [];

  const copiedSection = section;

  copiedSection.contents.section.subsections.forEach((subsection) => {
    subsection.parts.forEach((part) => {
      recursivelyAddMaskToQuestions(part.questions, fieldsToUpdate);
    });
  });

  console.log("Updated Field Count: ", fieldsUpdated.length);
  console.log("Fields expected to be updated: ", fieldsToUpdate.length);

  console.log(
    "Fields that weren't updated: ",
    fieldsToUpdate.filter((x) => !fieldsUpdated.includes(x))
  );

  return copiedSection;
};

const recursivelyAddMaskToQuestions = (questions, fieldsToUpdate) => {
  questions.forEach((question) => {
    if (fieldsToUpdate.includes(question?.id)) {
      question.mask = "lessThanEleven";
      fieldsUpdated.push(question.id);
    }
    if (question?.questions) {
      recursivelyAddMaskToQuestions(question.questions, fieldsToUpdate);
    }
  });
};

handler();
